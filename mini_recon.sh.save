#!/bin/bash

#Function1
getURL(){
read -p "Enter the URL to be processed:" value
read -p "Enter the cookie value if available:" cookie
read -p "Enter the domain value:" domain
if [ -z "$value" ];then
	echo "Input value is empty.Please enter the URL."
	exit
else
	rm -rf url.txt files_tmp.txt files.txt
	echo $value > url.txt
fi
if [ -z "$domain" ];then
        echo "Domain value is empty.Please enter the domain value."
        exit
fi
}

#Function2
#Function to enumerate all files existing under the URL(s)
enum_FILES(){
cat url.txt > files_tmp.txt
cat url.txt | subjs >> files_tmp.txt
if [ -z "$cookie" ];then
	#echo "check1"
	echo $value | ~/go/bin/hakrawler  -depth 3 -scope subs -plain | anew files_tmp.txt
else
   	#echo "check2"
	echo $value | ~/go/bin/hakrawler  -depth 3 -scope subs -plain -cookie $cookie | anew files_tmp.txt
fi
cat files_tmp.txt | grep -i $domain > files.txt
echo "!!All enumerated files are stored in files.txt file successfully!!"
#cat files.txt
}
#Function3
#Funtion to identify GF patterns
gf_PATTERN(){
for i in $(cat gf_patterns)
do
       for j in $(cat files.txt)
       do
               echo "----------------------------------------------------------------------------------------------"
               echo "URL:$j"
               echo "Pattern:$i"
               curl -k --compressed $j --silent | tac |tac |gf $i
               echo "----------------------------------------------------------------------------------------------"
       done
done
}

#Function5
#For extracting links from URLs and Javascript files
link_extractor(){
if [ -z "$cookie" ];then
	for i in $(cat files.txt)
	do
		echo "-------------------------$i------------------------------- > JScanner_results.txt`
		python3 /opt/tools/auto_recon/JSFinder/JSFinder.py -u $i -ou /opt/tools/auto_recon/links.txt -os /opt/tools/auto_recon/sub_domains.txt
		python3 /opt/tools/javascript_enumeration/JScanner-3.0/JScanner.py -w $i  -d getfeedback.com -t 40  > JScanner_results.txt
	done
else
	for i in $(cat files.txt)
        do
		echo $i
                python3 /opt/tools/auto_recon/JSFinder/JSFinder.py -u $i  -c "$cookie" -ou /opt/tools/auto_recon/links.txt -os /opt/tools/auto_recon/sub_domains.txt
        done
fi

}


#Switch case function to choose the options for recon
option_FN(){
echo "which recon do you want to perform?"
echo "Press \"1\" for identifying gf pattern values"
echo "Press \"2\" for extracting links from URLs and Javascript files"
echo "------------------------------------------------------------------"
read option
case $option in

1)
	gf_PATTERN
        ;;
2)
	#Funtion5
        link_extractor
        ;;
*)
        echo "Unknown value"
        ;;
esac

}




#Script starts here
echo "Do you want to perform recon for single url or multiple urls?"
echo "Press \"1\" for single URL"
echo "Press \"2\" for multiple URLS"
echo "-------------------------------------------------------------"
read option
case $option in

1)
	getURL
	enum_FILES
	#gf_PATTERN
#	link_extractor
	#option_FN
	;;
2)
	echo "multiple"
	;;
*)
	echo "Unknown value"
	;;
esac
